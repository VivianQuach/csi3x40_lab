<!DOCTYPE html>
<html lang = "en"> 
    <head> 
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>PacMan</title>
    </head>
    <body> 

        <script type = "text/javascript">
            function createGame(n, level = 1){
                const board = new Array(n).fill("."); 
                let pacman = Math.floor(Math.random() * n); 
                let fruit = Math.floor(Math.random() * n); 
                let ghost = Math.floor(Math.random() * n); 
                while (true){
                    if (pacman === ghost){
                        ghost = Math.floor(Math.random() * n); 
                    }else if (pacman === fruit){
                        fruit = Math.floor(Math.random() * n); 
                    }else if (fruit === ghost ){
                        ghost = Math.floor(Math.random() * n); 
                    }else{
                        break; 
                    }
                }
                board[pacman] = "C"; 
                board[ghost] = "^.";
                board[fruit] = "@";
                const gameState = {
                    board: board,
                    pacmanPosition: pacman,
                    ghostPosition: ghost,
                    score: 0,
                    level: level,
                    gameOver: false
                };
                console.log(gameState);
                return gameState;

            } 
            function moveRight(gameState){
                const board = gameState.board;
                let pacmanIndex = gameState.pacmanPosition;
                const n = board.length;
                let newIndex = gameState.pacmanPosition;
                if (pacmanIndex < n - 1) {
                    newIndex = pacmanIndex + 1;

                    if (board[newIndex] === ".") {
                        gameState.score += 1;
                        gameState.board[pacmanIndex] = " ";
                        gameState.board[newIndex] = "C";
                    } else if (board[newIndex] === "@") {
                        //gameState.score += 2; 
                        gameState.board[pacmanIndex] = " ";
                        gameState.board[newIndex] = "C";
                    } else if (board[newIndex] === "^." || board[newIndex] === "@^") {
                        gameState.board[pacmanIndex] = " ";
                        gameState.board[newIndex] = "^C";
                        gameState.gameOver = true;
                        console.log("Game Over!");
                        return gameState;
                    }else if (board[newIndex] === " "){
                        gameState.board[pacmanIndex] = " ";
                        gameState.board[newIndex] = "C";
                    }
                }
                if (!board.includes(".")) {
                    console.log("Level Complete!");
                    gameState = advanceLevel(gameState);
                }
                gameState.pacmanPosition = newIndex;

                console.log(gameState);
                return gameState;
            }
            function moveLeft(gameState){
                const board = gameState.board;
                let pacmanIndex = gameState.pacmanPosition;
                let newIndex = gameState.pacmanPosition;
                if (pacmanIndex > 0) {
                    newIndex = pacmanIndex - 1;

                    if (board[newIndex] === ".") {
                        gameState.score += 1;
                        gameState.board[pacmanIndex] = " ";
                        gameState.board[newIndex] = "C";
                    } else if (board[newIndex] === "@") {
                        gameState.score += 2; 
                        gameState.board[pacmanIndex] = " ";
                        gameState.board[newIndex] = "C";
                    } else if (board[newIndex] === "^." || board[newIndex] === "@^") {
                        gameState.board[pacmanIndex] = " ";
                        gameState.board[newIndex] = "^C";
                        gameState.gameOver = true; 
                        console.log("Game Over!");
                        
                        return gameState;
                    }else if (board[newIndex] === " "){
                        gameState.board[pacmanIndex] = " ";
                        gameState.board[newIndex] = "C";
                    } 
                }
                if (!board.includes(".")) {
                    console.log("Level Complete!");
                    gameState = advanceLevel(gameState);
                }
                gameState.pacmanPosition = newIndex;
                console.log(gameState);
                return gameState;
            }
            function advanceLevel(gameState){
                const newGameState = createGame(gameState.board.length, gameState.level + 1);
                newGameState.score = gameState.score; 
                console.log("Advancing to Level " + newGameState.level);
                return newGameState;
            }
            function moveGhost(gameState){
                if(gameState.gameOver){
                    return gameState;
                }

                const board = gameState.board; 
                let ghostIndex = gameState.ghostPosition;
                const n = board.length;
                const directions = [-1, 1];
                const direction = directions[Math.floor(Math.random() * directions.length)];
                let newIndex = ghostIndex + direction;

                if (newIndex >= 0 && newIndex < n) {
                if (board[newIndex] === "C") {
                    board[newIndex] = "^C";
                    console.log(gameState);
                    console.log("Game Over!");
                    gameState.gameOver = true;
                    return gameState;
                } else if (board[newIndex] === "@") {
                    board[newIndex] = "@^"; 
                } else {
                    board[newIndex] = "^";
                }

                if (board[ghostIndex] === "@^") {
                    board[ghostIndex] = "@";
                } else {
                    board[ghostIndex] = ".";
                }
                gameState.ghostPosition = newIndex;
            }
            console.log(gameState);
            return gameState;

            }
            var gameState = createGame(10);
            setInterval(() => {
                gameState = moveGhost(gameState);
            }, 10000);
            // For testing purpose it will be more than 2 seconds, aka 2000

        </script> 
    </body>
</html>